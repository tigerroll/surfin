surfin:
  # ===================================================================
  # I. データソース設定 (複数のデータベース)
  # ===================================================================
  datasources:
    # 1. フレームワークのメタデータ用データベース (Postgres)
    metadata:
      type: "postgres"
      host: "postgres"
      port: 5432
      database: "main"
      user: "weather"
      password: "weather"
      schema: "public"
      sslmode: "disable"
      # コネクションプール設定
      pool:
        max_open_conns: 10
        max_idle_conns: 5
        conn_max_lifetime_minutes: 5

    # 2. アプリケーションの業務データ用データベース (Postgres)
    workload:
      type: "postgres"
      host: "postgres"
      port: 5432
      database: "main"
      user: "weather"
      password: "weather"
      schema: "public"
      sslmode: "disable"
      # コネクションプール設定
      pool:
        max_open_conns: 10
        max_idle_conns: 5
        conn_max_lifetime_minutes: 5

    # 3. アプリケーションの業務データ用データベース (MySQL)
    mysql:
      type: "mysql"
      host: "mysql"
      port: 3306
      database: "main"
      user: "weather"
      password: "weather"
      schema: "main"
      sslmode: "disable"
      # コネクションプール設定
      pool:
        max_open_conns: 10
        max_idle_conns: 5
        conn_max_lifetime_minutes: 5

    # 4. ローカル開発/テスト用の SQLite データベース
    sqlite:
      type: "sqlite"
      database: "surfin.db" # ファイルパス
      pool:
        max_open_conns: 1
        max_idle_conns: 1
        conn_max_lifetime_minutes: 0

  # ===================================================================
  # II. バッチフレームワーク設定
  # ===================================================================
  batch:
    polling_interval_seconds: 3600 # ポーリング間隔（秒）
    api_endpoint: "https://api.open-meteo.com/v1" # Open-Meteo APIのベースURL
    api_key: "" #"your_api_key"
    job_name: "weatherJob"
    # ステップレベルのリトライ設定 (チャンク処理全体)
    retry:
      max_attempts: 3
      initial_interval: 1
      max_interval: 10
      factor: 2
      circuit_breaker_threshold: 3
      circuit_breaker_reset_interval: 60
    # アイテムレベルのリトライ設定
    item_retry:
      max_attempts: 3
      retryable_exceptions: ["io.EOF", "net.OpError"]
    # アイテムレベルのスキップ設定
    item_skip:
      skip_limit: 5
      skippable_exceptions: ["json.UnmarshalTypeError"]
    chunk_size: 50

  # ===================================================================
  # III. システム全体設定
  # ===================================================================
  system:
    timezone: "Asia/Tokyo"
    logging:
      level: "DEBUG"
      
  # ===================================================================
  # IV. インフラストラクチャ設定
  # ===================================================================
  infrastructure:
    job_repository_db_ref: "metadata" # JobRepositoryが使用するDB接続名
